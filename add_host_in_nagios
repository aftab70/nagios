
########################## Client site installation and configration of nrpe & nagios-plugin ########################

#!/bin/bash
set -e 
set -x

apt-get update && apt-get install build-essential libgd-dev openssl libssl-dev unzip curl -y
useradd -s /bin/false shipper
cd ~ && curl -L -O http://nagios-plugins.org/download/nagios-plugins-2.2.1.tar.gz
tar zxf nagios-plugins-*.tar.gz && cd nagios-plugins-*
./configure --with-nagios-user=shipper --with-nagios-group=shipper --with-openssl
make
make install
cd ~ && curl -L -O https://github.com/NagiosEnterprises/nrpe/releases/download/nrpe-3.2.1/nrpe-3.2.1.tar.gz
tar zxf nrpe-*.tar.gz && cd nrpe-*
./configure --enable-command-args  --with-nrpe-port=5676 --with-nagios-user=shipper --with-nagios-group=shipper --with-nrpe-group=shipper --with-nrpe-user=shipper --with-ssl=/usr/bin/openssl --with-ssl-lib=/usr/lib/x86_64-linux-gnu
make all
make install
make install-config
make install-init
systemctl enable nrpe.service
systemctl start nrpe.service
systemctl status nrpe.service

#####################################################################################################################

# if all good going, After that you need to add Nagios server IP address in nrpe.cfg file,
# Which file is located in /usr/local/nagios/etc/nrpe.cfg

vim /usr/local/nagios/etc/nrpe.cfg

# find the allowed_hosts=127.0.0.1,::1,YOUR_NAGIOS_SERVER_IP_HERE

save and exit

systemctl restart nrpe.service
systemctl status nrpe.service

# Need to verify some checks by following the commands.

execute - /usr/lib/nagios/plugins/check_procs -w 150 -c 200

You should get output:-- PROCS WARNING: 190 processes | procs=190;150;200;0;

execute  - /usr/lib/nagios/plugins/check_procs -w 200 -c 250

You should get output:-- PROCS OK: 189 processes | procs=189;200;250;0;

# Your client side nagios host configuration is completed..

############################################ Server-side nagios configuration ##########################################

# Login to your nagios-server with root privileges and edit the nagios main config file
# located in /usr/local/nagios/etc/nagios.cfg and add the nagios-client server directory or uncomment it.

vim /usr/local/nagios/etc/nagios.cfg

#uncommet the following lines 

cfg_dir=/usr/local/nagios/etc/servers

#save and exit & create the directory by following the commads.

mkdir /usr/local/nagios/etc/servers

# After that you need to confgure nagios nrpe commads to check nagios client.

vim /usr/local/nagios/etc/objects/commands.cfg

# Now add the following commads to check nrpe-client.

# .check_nrpe. command definition
define command{
command_name check_nrpe
command_line /usr/lib/nagios/plugins/check_nrpe -H $HOSTADDRESS$ -t 30 -c $ARG1$ -p $_HOSTTCPORT$
}

save and exit here...
















